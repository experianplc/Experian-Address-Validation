var addressValidationMap,addressValidationW3wMarker,addressValidationGeoMarker,options={searchType:"combined",maxSuggestions:10,maxSuggestionsForLookup:1e3,useSpinner:!1,elements:{countryList:document.querySelector("#country-dataset-container select#country"),address_line_1:document.querySelector("input[name='address_line_1']"),address_line_2:document.querySelector("input[name='address_line_2']"),address_line_3:document.querySelector("input[name='address_line_2']"),locality:document.querySelector("input[name='locality']"),region:document.querySelector("input[name='region']"),postal_code:document.querySelector("input[name='postal_code']"),country:document.querySelector("input[name='country']"),lookupButton:document.querySelector("button#find-address-button"),validateButton:document.querySelector("button#validate-address-button")}},address=new AddressValidation(options);function updateButtonVisibility(){const e=document.querySelector("button#find-address-button"),t=document.querySelector("button#validate-address-button");"validate"===address.searchType||"singleline"===address.searchType||"lookupv2"===address.searchType?(e.classList.remove("hidden"),t.classList.add("hidden")):"autocomplete"===address.searchType&&document.querySelector("input[name='Forename']")?(e.classList.add("hidden"),t.classList.remove("hidden")):(e.classList.add("hidden"),t.classList.add("hidden"))}var showDatasetBtn=document.getElementById("show-dataset-button");function addToken(){const e=document.querySelector('[name="token"]').value.trim();e?(address.setToken(e),document.querySelector("main").classList.remove("inactive"),document.querySelector(".token-prompt").classList.add("hidden"),window.dispatchEvent(new CustomEvent("validation-token-set",{detail:{token:e}}))):document.querySelector('[name="token"]').classList.add("input-error")}function setProgress(e,t){const s=e/t*100;document.querySelector(".progress").style.width=s+"%"}function createCustomDropdown(e){const t=document.createElement("div");t.className="custom-select";const s=document.createElement("div");s.className="custom-select-trigger";const d=document.createElement("div");function n(){const t=e.options[e.selectedIndex],d=t.getAttribute("data-iso2")||t.getAttribute("data-iso"),n=t.getAttribute("data-dialing");if(d){const e=d.toLowerCase();s.innerHTML=n?`<img src="https://flagcdn.com/20x15/${e}.png" class="country-flag" alt="">${n}`:`<img src="https://flagcdn.com/20x15/${e}.png" class="country-flag" alt="">${t.text}`}else s.innerHTML=t.text}d.className="custom-options",Array.from(e.options).forEach((s=>{if(s.value){const o=document.createElement("div");o.className="custom-option";const a=s.getAttribute("data-iso2")||s.getAttribute("data-iso");if(a){const e=a.toLowerCase();o.innerHTML=`<img src="https://flagcdn.com/20x15/${e}.png" class="country-flag" alt="">${s.text}`}else o.innerHTML=s.text;o.dataset.value=s.value,o.addEventListener("click",(()=>{e.value=s.value,e.dispatchEvent(new Event("change")),n(),t.classList.remove("open")})),d.appendChild(o)}})),s.addEventListener("click",(()=>t.classList.toggle("open"))),document.addEventListener("click",(e=>{t.contains(e.target)||t.classList.remove("open")})),t.appendChild(s),t.appendChild(d),e.style.display="none",e.parentNode.insertBefore(t,e),n(),e.addEventListener("change",n)}function togglePanel(e){document.querySelectorAll(".search-type-selector").forEach((e=>e.classList.remove("search-type-selected"))),e.currentTarget.classList.add("search-type-selected"),address.setSearchType(e.currentTarget.dataset.panelType)}function attachRateLimitToButton(e){const t=document.getElementById(e);t&&t.addEventListener("click",(function(e){if("1"!==t.dataset.rlBypass)if(e.preventDefault(),e.stopImmediatePropagation(),window.RateLimiter&&"function"==typeof window.RateLimiter.allowCall){const e=t.disabled;t.disabled=!0,window.RateLimiter.allowCall().then((function(s){if(t.disabled=e,s.allowed)t.dataset.rlBypass="1",t.click();else{const e=document.querySelector(".error-display");if(e){e.classList.remove("hidden");const t=e.getElementsByTagName("label")[0];t&&(t.innerText="You have reached the maximum of 10 validations in 24 hours.")}else alert("You have reached the maximum of 10 validations in 24 hours.")}})).catch((function(){t.disabled=e,t.dataset.rlBypass="1",t.click()}))}else t.dataset.rlBypass="1",t.click();else delete t.dataset.rlBypass}),!0)}showDatasetBtn&&showDatasetBtn.addEventListener("click",(function(){var e=document.getElementById("country-dataset-container"),t=document.getElementById("dataset-trigger");e&&t&&(e.classList.remove("hidden"),t.classList.add("hidden"))})),document.addEventListener("DOMContentLoaded",(function(){const e=document.querySelector("#country-code");e&&createCustomDropdown(e)})),document.querySelector("main").classList.add("inactive"),document.querySelector(".token-prompt").classList.remove("hidden"),address.events.on("post-datasets-update",(function(){let e=options.elements.countryList,t=e.getElementsByTagName("option");Array.from(t).filter((e=>"Please select"!==e.innerText)).forEach((e=>e.remove()));let s=address.countryDropdown;for(const t of s){const s=document.createElement("option"),d=t.iso3Code+";"+t.datasetCodes.join(",");s.setAttribute("value",d),s.setAttribute("data-iso2",t.iso2Code),s.setAttribute("data-iso3",t.iso3Code),s.setAttribute("data-datasets",t.datasetCodes.join(",")),s.innerText=t.country,e.append(s)}const d=Array.from(e.options).find((e=>"GBR"===e.getAttribute("data-iso3")));d&&(e.value=d.value);const n=new Event("change");e.dispatchEvent(n),createCustomDropdown(e),setProgress(1,4)})),address.events.on("post-country-list-change",(function(e,t){t="autocomplete",document.querySelectorAll(".search-type-selector").forEach((e=>e.classList.add("hidden"))),document.querySelectorAll("label[data-panel-type]").forEach((e=>e.classList.add("hidden"))),e.filter((e=>"typedown"!=e)).forEach((e=>{document.querySelectorAll("label[data-panel-type~='"+e+"'].show-by-default").forEach((e=>e.classList.remove("hidden")))})),document.querySelectorAll(".search-type-selector").forEach((e=>e.classList.remove("search-type-selected"))),document.querySelector("label.search-type-selector[data-panel-type='"+t+"']").classList.add("search-type-selected"),radiobtn=document.getElementById(t+"-radio"),radiobtn.checked=!0,setProgress(2,4)})),address.events.on("pre-formatting-search",(function(){"autocomplete"===address.searchType&&4===address.inputs.length||document.querySelector(".loader").classList.remove("hidden"),setProgress(3,4)})),address.events.on("pre-search",(function(){document.querySelector(".loader").classList.remove("hidden")})),address.events.on("post-formatting-search",(function(e){document.querySelector(".loader").classList.add("hidden"),document.querySelector("#validated-address-info").classList.remove("hidden"),"No matches"===e.result.confidence&&"combined"!==address.searchType&&"autocomplete"!==address.searchType||e.result.names?e.result.names&&(document.querySelector(".formatted-address").classList.remove("hidden"),document.querySelectorAll(".formatted-address .hidden").forEach((e=>e.classList.remove("hidden"))),document.querySelector(".promptset").classList.add("hidden"),document.querySelector("button#find-address-button").classList.add("hidden"),document.querySelector("button#validate-address-button").classList.add("hidden")):(document.querySelector(".formatted-address").classList.remove("hidden"),document.querySelectorAll(".formatted-address .hidden").forEach((e=>e.classList.remove("hidden"))),document.querySelector(".promptset").classList.add("hidden"),document.querySelector("button#find-address-button").classList.add("hidden"),document.querySelector("button#validate-address-button").classList.add("hidden"),document.querySelector("#validated-name").classList.add("hidden")),populateMetadata(e),setProgress(4,4)})),address.events.on("post-formatting-lookup",(function(e,t){document.querySelector("#validated-address-info").classList.add("hidden"),document.querySelectorAll(".formatted-address").forEach((e=>e.classList.remove("hidden"))),document.querySelector(".promptset").classList.add("hidden"),document.querySelector("button#find-address-button").classList.add("hidden"),document.querySelector("button#validate-address-button").classList.add("hidden"),address.getLookupEnrichmentData(e),document.querySelector(".metadata").classList.remove("invisible")})),address.events.on("post-reset",(function(){document.querySelector(".formatted-address").classList.add("hidden");try{resetMetadata()}catch(e){}document.querySelector(".promptset").classList.remove("hidden");const e=document.getElementById("address-validation-content"),t=document.getElementById("address-header-button");e&&t&&(e.classList.remove("hidden"),t.classList.remove("collapsed"));const s=document.querySelector("button#find-address-button"),d=document.querySelector("button#validate-address-button");s.classList.remove("hidden"),d.classList.remove("hidden"),updateButtonVisibility(),"lookupv2"===address.searchType&&(document.getElementById("address-input-0").getElementsByTagName("option")[0].selected="true",document.getElementById("address-input-1").getElementsByTagName("option")[0].selected="true")})),address.events.on("request-error",(function(){document.querySelector(".loader").classList.add("hidden")})),address.events.on("post-search",(function(){document.querySelector(".loader").classList.add("hidden")})),address.events.on("request-error-401",(function(){document.querySelector("main").classList.add("inactive"),document.querySelector(".token-prompt").classList.remove("hidden")})),address.events.on("post-promptset-check",(function(e){const t=[];let s=document.querySelector(".error-display");s.classList.contains("hidden")||(s.classList.add("hidden"),document.querySelector(".promptset").classList.remove("hidden")),document.querySelector(".address-field-inputs").innerHTML="",document.querySelector(".forename-field-inputs").innerHTML="",e.result.lines.forEach(((e,s)=>{const d=document.createElement("label");let n;d.setAttribute("for",`address-input-${s}`),d.innerText=e.prompt,e.dropdown_options?(n=document.createElement("select"),n.classList.add("address-input"),n.setAttribute("id",`address-input-${s}`),e.dropdown_options.forEach((e=>{const t=document.createElement("option");t.setAttribute("value",e.key),t.innerText=e.display,n.append(t)}))):(n=document.createElement("input"),n.classList.add("address-input"),n.setAttribute("type","text"),n.setAttribute("id",`address-input-${s}`),"Forename"===e.prompt?n.setAttribute("name","Forename"):"Middle Name"===e.prompt?n.setAttribute("name","Middle Name"):"Surname"===e.prompt&&n.setAttribute("name","Surname"),e.suggested_input_length&&n.setAttribute("size",e.suggested_input_length),e.example&&n.setAttribute("placeholder",e.example)),t.push(n),document.querySelector(".address-field-inputs").append(d,n)})),address.setInputs(t),updateButtonVisibility()})),address.events.on("error-display",(function(e){document.querySelector(".promptset").classList.add("hidden"),resetMetadata(),document.querySelectorAll(".formatted-address").forEach((e=>e.classList.add("hidden")));let t=document.querySelector(".error-display");t.classList.remove("hidden"),t.getElementsByTagName("label")[0].innerText=e})),document.querySelectorAll(".search-type-selector").forEach((e=>e.addEventListener("click",togglePanel)));