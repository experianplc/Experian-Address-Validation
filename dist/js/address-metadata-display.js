function populateMetadata(e){null!=e.enrichment&&address.getEnrichmentData(e.enrichment);const t=e.result.confidence;if(t&&(document.querySelector(".metadata #confidence-key").innerText="Verified match"===t?"‚úî":"‚ùå",document.querySelector(".metadata #confidence-value").innerText=t),e.metadata&&e.metadata.address_classification){const t=e.metadata.address_classification.delivery_type;t&&(document.querySelector(".metadata #delivery-type-key").innerText="residential"===t?"üè°":"üè¢",document.querySelector(".metadata #delivery-type-value").innerText=t.substring(0,1).toUpperCase()+t.substring(1))}document.querySelector(".metadata #delivery-address-key").innerHTML=e.result.address?'<img src="./dist/images/marker-icon-s.png"/>':"",e.result.address?document.querySelector(".metadata #delivery-address-value").innerHTML=Object.values(e.result.address).filter((e=>""!==e)).join("<br>"):e.result.addresses_formatted[0].address.gas_meters?document.querySelector(".metadata #delivery-address-value").innerHTML=Object.entries(e.result.addresses_formatted[0].address.gas_meters[0]).filter((e=>""!==e[1])).map((e=>e[0]+": "+e[1])).join("<br>"):e.result.addresses_formatted[0].address.electricity_meters?document.querySelector(".metadata #delivery-address-value").innerHTML=Object.entries(e.result.addresses_formatted[0].address.electricity_meters[0]).filter((e=>""!==e[1])).map((e=>e[0]+": "+e[1])).join("<br>"):document.querySelector(".metadata #delivery-address-value").innerHTML="",document.querySelector(".metadata").classList.remove("invisible"),populateAddressAdditionalInfo(address.componentsCollectionMap,document.querySelector("#components-collection")),populateAddressAdditionalInfo(address.metadataCollectionMap,document.querySelector("#metadata-collection"))}function populateAddressAdditionalInfo(e,t,a,d){if(e.size>0){let s=t.getElementsByClassName("content")[0];t.classList.remove("hidden");let n=s;if(a){let e=document.createElement("div");const t=document.createElement("h3");if(t.innerText=a,e.append(t),d){let t=document.createElement("span");t.classList.add("collapsible"),createCollapsibleELement(t,d);let a=document.createElement("div");a.classList.add("content"),a.setAttribute("style","display: none;"),n=a,e.append(t,a)}s.append(e)}populateContent(e,n)}}function createCollapsibleELement(e,t){let a=document.createElement("span");a.innerText="[Hide]",a.classList.add(`hide${t}`),a.classList.add("hidden");let d=document.createElement("span");d.innerText="[Show]",d.classList.add(`show${t}`),e.append(a,d),addCollapsibleEventListener(e,`.hide${t}`,`.show${t}`)}function populateContent(e,t){e.forEach(((e,a)=>{const d=document.createElement("span");let s=document.createElement("br");if("object"==typeof e)d.innerText=`${a}: `,t.append(d,s),addChildElement(Object.entries(e),t,1,!0);else{if(address.tooltipDescriptionMap.has(a)){let t=document.createElement("div");t.classList.add("tooltip"),t.innerText=`${e}`;let s=document.createElement("span");s.classList.add("tooltiptext"),s.innerText=`${address.tooltipDescriptionMap.get(a)}`,t.append(s),d.innerText=`${a}: `,d.append(t)}else d.innerText=`${a}: ${e}`;t.append(d,s)}})),t.append(document.createElement("br"))}function addChildElement(e,t,a,d){for(const[s,n]of e){const e=document.createElement("span");let r=document.createElement("br");if(e.classList.add("tab"),e.setAttribute("style","--spaces: "+2*a+"em;"),"object"==typeof n){let o=a;d&&(e.innerText=`${s}: `,o=a+1,t.append(e,r)),addChildElement(Object.entries(n),t,o,!(Array.isArray(n)&&1===n.length))}else e.innerText=`${s}: ${n}`,t.append(e,r)}}function resetMetadata(){document.querySelector(".metadata #confidence-key").innerText="",document.querySelector(".metadata #confidence-value").innerText="",document.querySelector(".metadata #delivery-type-key").innerText="",document.querySelector(".metadata #delivery-type-value").innerText="",document.querySelector(".metadata #what3words-key").classList.add("hidden"),document.querySelector(".metadata #what3words-value").classList.add("hidden"),document.querySelector(".metadata").classList.add("invisible"),resetMetadataElements(document.getElementById("validated-address-info")),resetMetadataElements(document.getElementById("components-collection"),!0),document.querySelector("#components-collection").classList.add("hidden"),resetMetadataElements(document.getElementById("metadata-collection"),!0),document.querySelector("#metadata-collection").classList.add("hidden"),resetMetadataElements(document.getElementById("enrichment"),!0),document.querySelector("#enrichment").classList.add("hidden"),document.querySelector("#map").classList.add("hidden")}function resetMetadataElements(e,t){t&&(e.querySelector(".hide").classList.add("hidden"),e.querySelector(".show").classList.remove("hidden")),e.querySelectorAll(".content").forEach((e=>{e.style.display=t?"none":"block",t&&(removeElements(e.getElementsByTagName("div")),removeElements(e.getElementsByTagName("span")),removeElements(e.getElementsByTagName("br")),removeElements(e.getElementsByTagName("h3")))}))}function removeElements(e){Array.from(e).forEach((e=>e.remove()))}function onContentLoaded(){document.querySelectorAll(".collapsible").forEach((e=>addCollapsibleEventListener(e,".hide",".show")))}function addCollapsibleEventListener(e,t,a){e.addEventListener("click",(function(){let e=this.nextElementSibling,d=e.parentElement,s=d.querySelector(t),n=d.querySelector(a);"block"===e.style.display?(e.style.display="none",s.classList.add("hidden"),n.classList.remove("hidden")):(e.style.display="block",s.classList.remove("hidden"),n.classList.add("hidden"))}))}address.events.on("post-enrichment",(function(e){let t=document.querySelector("#enrichment");if(address.geocodes.detailsMap.size>0||e.result.what3words&&e.result.what3words.latitude||address.cvHousehold.detailsMap.size>0){let n,r,o,i,l,c;document.querySelector(".metadata #what3words-key").classList.add("hidden"),document.querySelector(".metadata #what3words-value").classList.add("hidden"),t.classList.remove("hidden"),populateAddressAdditionalInfo(address.cvHousehold.detailsMap,t,address.cvHousehold.title,1),populateAddressAdditionalInfo(address.geocodes.detailsMap,t,address.geocodes.title,2),e.result.what3words&&e.result.what3words.latitude&&(document.querySelector(".metadata #what3words-key").classList.remove("hidden"),document.querySelector(".metadata #what3words-value").classList.remove("hidden"),document.querySelector(".metadata #what3words-value").innerHTML="///"+e.result.what3words.name,n=e.result.what3words.latitude,r=e.result.what3words.longitude,o=[n,r]),e.result.nzl_regional_geocodes?(i=address.geocodes.detailsMap.get("Centroid of Property Latitude"),l=address.geocodes.detailsMap.get("Centroid of Property Longitude")):(i=address.geocodes.detailsMap.get("Latitude"),l=address.geocodes.detailsMap.get("Longitude")),i&&l&&(c=[i,l]);var a=L.icon({iconUrl:"./dist/images/w3w.loc.png",iconSize:[30,37],iconAnchor:[15,36],popupAnchor:[0,-20]});if(o||c){document.querySelector("#map").classList.remove("hidden"),addressValidationMap?(addressValidationW3wMarker&&addressValidationW3wMarker.remove(),addressValidationGeoMarker&&addressValidationGeoMarker.remove()):(addressValidationMap=L.map("map").setView([51.500264,.633506],16),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(addressValidationMap));var d=[];o&&(addressValidationMap.panTo(o,{duration:1}),addressValidationW3wMarker=L.marker(o,{icon:a}).addTo(addressValidationMap),d.push(addressValidationW3wMarker)),c&&(addressValidationMap.panTo(c,{duration:1}),addressValidationGeoMarker=L.marker(c).addTo(addressValidationMap),d.push(addressValidationGeoMarker));var s=L.featureGroup(d);addressValidationMap.fitBounds(s.getBounds().pad(.25))}}address.premiumLocationInsightMap.size>0&&(t.classList.remove("hidden"),populateAddressAdditionalInfo(address.premiumLocationInsightMap,t,"Premium Location Insight",3))})),document.addEventListener("DOMContentLoaded",onContentLoaded);