!function(t){const e="validation_user_id";function r(t){const e=String(t).split(".").map(Number);return 4!==e.length||e.some((t=>Number.isNaN(t)||t<0||t>255))?null:(e[0]<<24>>>0)+(e[1]<<16>>>0)+(e[2]<<8>>>0)+(e[3]>>>0)}function i(t){if(!t)return t;let e=String(t).trim();if(/^\d{1,3}(?:\.\d{1,3}){3}$/.test(e))return e;let r=e.match(/(?:.*:)?ffff:(\d{1,3}(?:\.\d{1,3}){3})$/i);if(r&&r[1])return r[1];if(r=e.match(/(?:.*:)?ffff:([0-9a-fA-F]{1,4}):([0-9a-fA-F]{1,4})$/),r){const t=parseInt(r[1],16),i=parseInt(r[2],16);return Number.isNaN(t)||Number.isNaN(i)?e:`${t>>8&255}.${255&t}.${i>>8&255}.${255&i}`}return e}function n(t,e){try{const[i,n]=e.split("/");if(!i||!n)return!1;const s=Number(n);if(Number.isNaN(s)||s<0||s>32)return!1;const o=r(t),a=r(i);if(null===o||null===a)return!1;const u=0===s?0:-1<<32-s>>>0;return(o&u)==(a&u)}catch(t){return!1}}function s(){return Date.now()}t.RateLimiter=new class{constructor({maxCalls:t=10,windowMs:e=864e5}={}){this.maxCalls=t,this.windowMs=e,this.ip=null,this.clientId=this.ensureClientId(),this.ipPromise=null,this.resolveIp().catch((()=>{}))}ensureClientId(){let t=function(t){const e=document.cookie?document.cookie.split(";").map((t=>t.trim())):[];for(const r of e)if(0===r.indexOf(t+"="))return decodeURIComponent(r.substring(19));return null}(e);return t||(t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){const e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})),function(t,e){const r=";expires="+new Date(Date.now()+31536e6).toUTCString();document.cookie=t+"="+encodeURIComponent(e)+r+";path=/"}(e,t)),t}resolveIp(){return this.ipPromise||(this.ipPromise=function(t,e=3e3){return new Promise(((r,i)=>{const n=setTimeout((()=>i(new Error("timeout"))),e);fetch(t).then((t=>{clearTimeout(n),r(t)})).catch((t=>{clearTimeout(n),i(t)}))}))}("https://api64.ipify.org?format=json",2500).then((t=>t.json())).then((t=>this.ip=t&&t.ip?i(t.ip):"unknown")).catch((()=>{this.ip="unknown"}))),this.ipPromise}storageKey(){return"rateLimit:"+(this.ip||"unknown")+":"+this.clientId}loadTimestamps(){const t=this.storageKey();try{const e=localStorage.getItem(t);if(!e)return[];const r=JSON.parse(e);return Array.isArray(r)?r.map(Number).filter((t=>!Number.isNaN(t))):[]}catch(t){return[]}}saveTimestamps(t){try{localStorage.setItem(this.storageKey(),JSON.stringify(t))}catch(t){}}prune(t){const e=s()-this.windowMs;return t.filter((t=>t>=e))}isIpExcluded(e){try{if(!e)return!1;e=i(e);const r=function(){try{if(t&&t.EXCLUDED_IPS){if(Array.isArray(t.EXCLUDED_IPS))return t.EXCLUDED_IPS.map(String).map((t=>t.trim())).filter(Boolean);if("string"==typeof t.EXCLUDED_IPS)return t.EXCLUDED_IPS.split(",").map((t=>t.trim())).filter(Boolean)}}catch(t){}try{if("undefined"!=typeof process&&process&&process.env&&process.env.EXCLUDED_IPS)return String(process.env.EXCLUDED_IPS).split(",").map((t=>t.trim())).filter(Boolean)}catch(t){}try{if(t&&Array.isArray(t.RATE_LIMIT_EXCLUDE))return t.RATE_LIMIT_EXCLUDE.map(String).map((t=>t.trim())).filter(Boolean)}catch(t){}return[]}();if(!r||0===r.length)return!1;for(let t=0;t<r.length;t++){const i=r[t];if(i)if(-1!==i.indexOf("/")){if(n(e,i))return!0}else if(i===e)return!0}}catch(t){}return!1}async allowCall(){await this.resolveIp();try{if(this.isIpExcluded(this.ip))return{allowed:!0,remaining:1/0,excluded:!0,resetMs:0}}catch(t){}let t=this.loadTimestamps();if(t=this.prune(t),t.length>=this.maxCalls){this.saveTimestamps(t);const e=t[0]||s();return{allowed:!1,remaining:0,resetMs:Math.max(0,e+this.windowMs-s())}}return t.push(s()),this.saveTimestamps(t),{allowed:!0,remaining:Math.max(0,this.maxCalls-t.length),resetMs:this.windowMs}}async getRemaining(){await this.resolveIp();try{if(this.isIpExcluded(this.ip))return{remaining:1/0,excluded:!0}}catch(t){}const t=this.prune(this.loadTimestamps());return{remaining:Math.max(0,this.maxCalls-t.length)}}waitForIp(){return this.resolveIp()}}}(window);