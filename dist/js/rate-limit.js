!function(t){const e="validation_user_id";function r(t){const e=String(t).split(".").map(Number);return 4!==e.length||e.some((t=>Number.isNaN(t)||t<0||t>255))?null:(e[0]<<24>>>0)+(e[1]<<16>>>0)+(e[2]<<8>>>0)+(e[3]>>>0)}function n(t,e){try{const[n,i]=e.split("/");if(!n||!i)return!1;const s=Number(i);if(Number.isNaN(s)||s<0||s>32)return!1;const o=r(t),a=r(n);if(null===o||null===a)return!1;const c=0===s?0:-1<<32-s>>>0;return(o&c)==(a&c)}catch(t){return!1}}t.RateLimiter=new class{constructor({maxCalls:t=1e6,windowMs:e=864e5}={}){this.maxCalls=t,this.windowMs=e,this.ip=null,this.clientId=this.ensureClientId(),this.ipPromise=null,this.resolveIp().catch((()=>{}))}ensureClientId(){let t=function(t){const e=document.cookie?document.cookie.split(";").map((t=>t.trim())):[];for(const r of e)if(0===r.indexOf(t+"="))return decodeURIComponent(r.substring(19));return null}(e);return t||(t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){const e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})),function(t,e){const r=";expires="+new Date(Date.now()+31536e6).toUTCString();document.cookie=t+"="+encodeURIComponent(e)+r+";path=/"}(e,t)),t}resolveIp(){return this.ipPromise||(this.ipPromise=Promise.resolve().then((()=>{this.ip="0.0.0.0"}))),this.ipPromise}storageKey(){return"rateLimit:"+(this.ip||"unknown")+":"+this.clientId}loadTimestamps(){const t=this.storageKey();try{const e=localStorage.getItem(t);if(!e)return[];const r=JSON.parse(e);return Array.isArray(r)?r.map(Number).filter((t=>!Number.isNaN(t))):[]}catch(t){return[]}}saveTimestamps(t){try{localStorage.setItem(this.storageKey(),JSON.stringify(t))}catch(t){}}prune(t){const e=Date.now()-this.windowMs;return t.filter((t=>t>=e))}isIpExcluded(e){try{if(!e)return!1;e=function(t){if(!t)return t;let e=String(t).trim();if(/^\d{1,3}(?:\.\d{1,3}){3}$/.test(e))return e;let r=e.match(/(?:.*:)?ffff:(\d{1,3}(?:\.\d{1,3}){3})$/i);if(r&&r[1])return r[1];if(r=e.match(/(?:.*:)?ffff:([0-9a-fA-F]{1,4}):([0-9a-fA-F]{1,4})$/),r){const t=parseInt(r[1],16),n=parseInt(r[2],16);return Number.isNaN(t)||Number.isNaN(n)?e:`${t>>8&255}.${255&t}.${n>>8&255}.${255&n}`}return e}(e);const r=function(){try{if(t&&t.EXCLUDED_IPS){if(Array.isArray(t.EXCLUDED_IPS))return t.EXCLUDED_IPS.map(String).map((t=>t.trim())).filter(Boolean);if("string"==typeof t.EXCLUDED_IPS)return t.EXCLUDED_IPS.split(",").map((t=>t.trim())).filter(Boolean)}}catch(t){}try{if("undefined"!=typeof process&&process&&process.env&&process.env.EXCLUDED_IPS)return String(process.env.EXCLUDED_IPS).split(",").map((t=>t.trim())).filter(Boolean)}catch(t){}try{if(t&&Array.isArray(t.RATE_LIMIT_EXCLUDE))return t.RATE_LIMIT_EXCLUDE.map(String).map((t=>t.trim())).filter(Boolean)}catch(t){}return[]}();if(!r||0===r.length)return!1;for(let t=0;t<r.length;t++){const i=r[t];if(i)if(-1!==i.indexOf("/")){if(n(e,i))return!0}else if(i===e)return!0}}catch(t){}return!1}async allowCall(){return await this.resolveIp(),{allowed:!0,remaining:1/0,excluded:!0,resetMs:0}}async getRemaining(){await this.resolveIp();try{if(this.isIpExcluded(this.ip))return{remaining:1/0,excluded:!0}}catch(t){}const t=this.prune(this.loadTimestamps());return{remaining:Math.max(0,this.maxCalls-t.length)}}waitForIp(){return this.resolveIp()}}}(window);